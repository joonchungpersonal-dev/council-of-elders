<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Council of Elders</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/desktop/css/variables.css">
    <link rel="stylesheet" href="/static/desktop/css/base.css">
    <link rel="stylesheet" href="/static/desktop/css/layout.css">
    <link rel="stylesheet" href="/static/desktop/css/sidebar.css">
    <link rel="stylesheet" href="/static/desktop/css/chat.css">
    <link rel="stylesheet" href="/static/desktop/css/input.css">
    <link rel="stylesheet" href="/static/desktop/css/header.css">
    <link rel="stylesheet" href="/static/desktop/css/animations.css">
    <link rel="stylesheet" href="/static/desktop/css/enrichment.css">
    <link rel="stylesheet" href="/static/desktop/css/elder-profile.css">
    <link rel="stylesheet" href="/static/desktop/css/avatars.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-drag-region"></div>

        <div class="sidebar-section">
            <button class="new-chat-btn" id="btn-new-chat">+ New Chat</button>
        </div>

        <div class="sidebar-section">
            <div class="section-label">Mode</div>
            <div class="mode-selector" id="mode-selector">
                <button class="mode-btn active" data-mode="panel">Panel</button>
                <button class="mode-btn" data-mode="salon">Salon</button>
                <button class="mode-btn" data-mode="roundtable">Roundtable</button>
                <button class="mode-btn" data-mode="ask">Ask</button>
                <button class="mode-btn" data-mode="intake">Intake</button>
                <span class="mode-divider"></span>
                <button class="mode-btn mode-btn-fun" data-mode="rap">Rap</button>
                <button class="mode-btn mode-btn-fun" data-mode="poetry">Poetry</button>
            </div>
            <div class="discussion-style-section" id="discussion-style-section">
                <div class="section-label" style="margin-top: 10px; margin-bottom: 2px; font-size: 10px;"
                     title="Controls how much the elders agree vs. challenge each other">Discussion Tone</div>
                <div class="slider-labels">
                    <span class="slider-label-left">Collaborative</span>
                    <span class="slider-label-right">Debate</span>
                </div>
                <input type="range" class="tension-slider" id="tension-slider"
                    min="0" max="100" value="50" step="1">
            </div>
        </div>

        <div class="sidebar-section">
            <div class="section-label-row">
                <div class="section-label">Elders</div>
                <label class="auto-select-toggle" id="auto-select-toggle" title="Let the AI choose the best elders for your question">
                    <input type="checkbox" id="auto-select-checkbox" checked>
                    <span class="auto-select-label">Auto</span>
                </label>
            </div>
            <div class="elder-list" id="elder-list">
                {% for elder in elders %}
                <label class="elder-item" data-elder-id="{{ elder.id }}" data-color="{{ elder.color }}">
                    <input type="checkbox" value="{{ elder.id }}">
                    <img class="elder-avatar elder-avatar--sm" src="/static/desktop/img/avatars/{{ elder.id }}.jpg" alt="" width="24" height="24" onerror="this.outerHTML=ElderAvatars.initialHtml('{{ elder.name }}',''+ElderColors.get('{{ elder.color }}'),24)">
                    <span class="elder-name">{{ elder.name }}</span>
                    <span class="elder-era">{{ elder.era }}</span>
                </label>
                {% endfor %}
            </div>
            <div class="settings-row auto-select-limit-inline" id="auto-select-limit-row" style="margin-top: 6px;">
                <span class="settings-label">Auto-select up to</span>
                <select class="settings-select" id="auto-select-limit-select">
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5" selected>5</option>
                    <option value="7">7</option>
                </select>
            </div>
        </div>

        <div class="sidebar-section" id="custom-elders-section" style="display: none;">
            <div class="section-label">Custom Elders</div>
            <div class="elder-list" id="custom-elder-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="sidebar-section" style="flex-shrink: 0;">
            <div class="section-label">Provider</div>
            <div class="provider-selector" id="provider-selector">
                <button class="mode-btn active" data-provider="ollama">Ollama</button>
                <button class="mode-btn" data-provider="anthropic">Claude API</button>
            </div>
            <div class="api-key-row" id="api-key-row" style="display: none;">
                <input type="password" class="api-key-input" id="api-key-input"
                    placeholder="sk-ant-..." autocomplete="off">
                <button class="api-key-save" id="api-key-save">Save</button>
            </div>
            <div class="model-pull-row" id="model-pull-row">
                <input type="text" class="api-key-input" id="model-pull-input"
                    placeholder="e.g. qwen2.5:14b" autocomplete="off">
                <button class="api-key-save" id="model-pull-btn">Pull</button>
            </div>
            <div class="pull-progress" id="pull-progress" style="display: none;">
                <div class="pull-progress-bar"><div class="pull-progress-fill" id="pull-progress-fill"></div></div>
                <div class="pull-progress-text" id="pull-progress-text">Downloading...</div>
            </div>
        </div>

        <div class="sidebar-section sidebar-history">
            <div class="section-label-row">
                <div class="section-label">History</div>
                <button class="clear-history-btn" id="btn-clear-history" title="Clear all history">Clear</button>
            </div>
            <div class="history-list" id="history-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="sidebar-bottom">
            <button class="settings-gear-btn" id="settings-gear-btn" title="Settings">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                    <path d="M6.5 1L6.1 2.8C5.6 3 5.2 3.3 4.8 3.6L3 3.1L1.5 5.7L2.9 7C2.9 7.3 2.9 7.7 2.9 8C2.9 8.3 2.9 8.7 3 9L1.5 10.3L3 12.9L4.8 12.4C5.2 12.7 5.6 13 6.1 13.2L6.5 15H9.5L9.9 13.2C10.4 13 10.8 12.7 11.2 12.4L13 12.9L14.5 10.3L13.1 9C13.1 8.7 13.1 8.3 13.1 8C13.1 7.7 13.1 7.3 13 7L14.5 5.7L13 3.1L11.2 3.6C10.8 3.3 10.4 3 9.9 2.8L9.5 1H6.5ZM8 5.5C9.4 5.5 10.5 6.6 10.5 8C10.5 9.4 9.4 10.5 8 10.5C6.6 10.5 5.5 9.4 5.5 8C5.5 6.6 6.6 5.5 8 5.5Z" stroke="currentColor" stroke-width="1.2" fill="none"/>
                </svg>
                Settings
            </button>
        </div>
    </aside>

    <!-- Settings Modal -->
    <div class="settings-overlay" id="settings-overlay">
        <div class="settings-modal" id="settings-modal">
            <div class="settings-modal-header">
                <h3>Settings</h3>
                <button class="settings-modal-close" id="settings-modal-close">&times;</button>
            </div>
            <div class="settings-modal-body">
                <div class="settings-group">
                    <div class="settings-group-label">Discussion</div>
                    <div class="settings-row">
                        <span class="settings-label">Response Length</span>
                        <select class="settings-select" id="response-length-select">
                            <option value="brief">Brief (1-2 sent)</option>
                            <option value="moderate" selected>Moderate (3-4 sent)</option>
                            <option value="detailed">Detailed (5-8 sent)</option>
                            <option value="extended">Extended (10-15 sent)</option>
                            <option value="unlimited">Unlimited</option>
                        </select>
                    </div>
                    <div class="settings-row" id="duration-row">
                        <span class="settings-label">Duration</span>
                        <select class="settings-select" id="discussion-length-select">
                            <option value="lightning">Lightning (~5 min)</option>
                            <option value="quick" selected>Quick (~10 min)</option>
                            <option value="short">Short (~20 min)</option>
                            <option value="medium">Medium (~30 min)</option>
                            <option value="long">Long (~45 min)</option>
                            <option value="extended">Extended (~60 min)</option>
                        </select>
                    </div>
                    <div class="settings-row" id="poetry-form-row" style="display: none;">
                        <span class="settings-label">Poetry Form</span>
                        <select class="settings-select" id="poetry-form-select">
                            <option value="spoken_word">Spoken Word</option>
                            <option value="free_verse">Free Verse</option>
                            <option value="haiku">Haiku (5-7-5)</option>
                            <option value="sonnet">Sonnet (14 lines)</option>
                            <option value="limerick">Limerick (AABBA)</option>
                            <option value="villanelle">Villanelle</option>
                            <option value="ballad">Ballad</option>
                            <option value="ghazal">Ghazal</option>
                            <option value="tanka">Tanka (5-7-5-7-7)</option>
                            <option value="ode">Ode</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <div class="settings-group-label">Voice (Podcast)</div>
                    <div class="tts-provider-selector" id="tts-provider-selector">
                        <button class="mode-btn active" data-tts="macos">Free (macOS)</button>
                        <button class="mode-btn" data-tts="elevenlabs">ElevenLabs</button>
                    </div>
                    <div class="elevenlabs-settings" id="elevenlabs-settings" style="display: none;">
                        <div class="elevenlabs-key-row" id="elevenlabs-key-row">
                            <input type="password" class="api-key-input" id="elevenlabs-key-input"
                                placeholder="ElevenLabs API key..." autocomplete="off">
                            <button class="api-key-save" id="elevenlabs-key-save">Save</button>
                        </div>
                        <div class="elevenlabs-model-row">
                            <select class="elevenlabs-model-select" id="elevenlabs-model-select">
                                <option value="eleven_multilingual_v2">Multilingual v2 (quality)</option>
                                <option value="eleven_flash_v2_5">Flash v2.5 (fast)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <a class="settings-link" href="/static/desktop/img/avatars/ATTRIBUTION.md" target="_blank" rel="noopener">Image Credits</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <div class="main-area">
        <!-- Header -->
        <header class="top-bar" id="top-bar">
            <div class="top-bar-left">
                <span class="status-dot disconnected" id="status-dot"></span>
                <span class="status-text" id="status-text">Connecting...</span>
            </div>
            <div class="top-bar-center">
                <select class="model-select" id="model-select">
                    <option>Loading models...</option>
                </select>
            </div>
            <div class="top-bar-right">
                <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                    <span class="theme-icon">◑</span>
                </button>
            </div>
        </header>

        <!-- Chat area -->
        <main class="chat-area" id="chat-area">
            <div class="chat-messages" id="chat-messages">
                <div class="welcome-message" id="welcome-message">
                    <h2>Council of Elders</h2>
                    <p>Seek wisdom from history's greatest thinkers.</p>
                    <div class="welcome-modes">
                        <div class="welcome-mode-card">
                            <div class="welcome-mode-name">Roundtable</div>
                            <div class="welcome-mode-desc">Each elder weighs in on your question, building on each other's perspectives.</div>
                        </div>
                        <div class="welcome-mode-card">
                            <div class="welcome-mode-name">Panel</div>
                            <div class="welcome-mode-desc">Elders converse naturally like an academic seminar — debating, agreeing, and nominating the next speaker.</div>
                        </div>
                        <div class="welcome-mode-card">
                            <div class="welcome-mode-name">Salon</div>
                            <div class="welcome-mode-desc">An assertive moderator orchestrates dynamic discussion — assigning speaking time and interrupting when needed.</div>
                        </div>
                        <div class="welcome-mode-card">
                            <div class="welcome-mode-name">Ask</div>
                            <div class="welcome-mode-desc">A private one-on-one consultation with a single elder of your choice.</div>
                        </div>
                        <div class="welcome-mode-card">
                            <div class="welcome-mode-name">Intake</div>
                            <div class="welcome-mode-desc">Elders first debate what to ask you, then give deeper counsel informed by your answers.</div>
                        </div>
                        <div class="welcome-mode-card">
                            <div class="welcome-mode-name">Rap Battle</div>
                            <div class="welcome-mode-desc">Two elders trade philosophical bars in a moderated rap battle. The Battle Host judges and declares a winner.</div>
                        </div>
                        <div class="welcome-mode-card">
                            <div class="welcome-mode-name">Poetry Slam</div>
                            <div class="welcome-mode-desc">Elders perform spoken-word poetry on your topic. The Slam MC scores each performance and crowns a champion.</div>
                        </div>
                    </div>
                    <p class="welcome-hint">Choose a mode and ask your question. The AI will select the best elders, or pick your own.</p>
                    <div class="welcome-privacy">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="flex-shrink:0;margin-top:1px">
                            <path d="M8 1L2 4V7.5C2 11.1 4.5 14.4 8 15.5C11.5 14.4 14 11.1 14 7.5V4L8 1Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            <path d="M6 8L7.5 9.5L10.5 6.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Your conversations stay on your device. When using Claude API, Anthropic does not train on API data. When using Ollama, everything runs 100% locally.</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Input area -->
        <footer class="input-area" id="input-area">
            <div class="input-wrapper">
                <textarea
                    class="chat-input"
                    id="chat-input"
                    placeholder="What question do you have for the council?"
                    rows="1"
                    spellcheck="true"
                    autocorrect="on"
                    autocapitalize="sentences"
                ></textarea>
                <button class="voice-btn" id="voice-btn" title="Voice input">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 1C6.9 1 6 1.9 6 3V8C6 9.1 6.9 10 8 10C9.1 10 10 9.1 10 8V3C10 1.9 9.1 1 8 1Z" fill="currentColor"/>
                        <path d="M12 8C12 10.2 10.2 12 8 12C5.8 12 4 10.2 4 8H3C3 10.7 5 13 7.5 13.4V15H8.5V13.4C11 13 13 10.7 13 8H12Z" fill="currentColor"/>
                    </svg>
                </button>
                <button class="send-btn" id="send-btn" disabled>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M3 13L13 8L3 3V7L9 8L3 9V13Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
        </footer>
    </div>

    <!-- Elder data for JS -->
    <script>
        window.__ELDERS__ = {{ elders | tojson }};
    </script>

    <!-- JS modules -->
    <script src="/static/desktop/js/elder-colors.js"></script>
    <script src="/static/desktop/js/elder-avatars.js"></script>
    <script src="/static/desktop/js/theme.js"></script>
    <script src="/static/desktop/js/state.js"></script>
    <script src="/static/desktop/js/api.js"></script>
    <script src="/static/desktop/js/header.js"></script>
    <script src="/static/desktop/js/sidebar.js"></script>
    <script src="/static/desktop/js/chat.js"></script>
    <script src="/static/desktop/js/input.js"></script>
    <script src="/static/desktop/js/enrichment.js"></script>
    <script src="/static/desktop/js/elder-profile.js"></script>
    <script src="/static/desktop/js/app.js"></script>
</body>
</html>
